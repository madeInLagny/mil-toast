<!-- 

** La page qui appelle le toast doit être associée au mixin NotificationMixin

Méthodes pour afficher un toast:

Affichage temporaire:
this. showToast('test', 'success');

Affichage durable:
this.showStickyToast("test sticky toast", "info", true);
Si true est ajouté, la page se recharge lors du click sur le toast.
this.closeStickyToast("test sticky toast", "info");

** Le texte doit être identique entre showStickyToast et closeStickyToast

 -->



<link rel="import" href="../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../bower_components/polymer/lib/mixins/gesture-event-listeners.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/polymer/lib/elements/dom-repeat.html">
<link rel="import" href="../mil-formatted-html/mil-formatted-html.html">
<link rel="import" href="../../src/bootstrap/bootstrap.html">
<link rel="import" href="toast-icon.html">

<dom-module id="mil-toast">
    <template>
        <style include="bootstrap shared-styles">
            .success {
                border-color: var(--success-color, #16D39A) !important;
                background-color: var(--success-color-background, #45ECB9) !important;
                color: var(--success-color-text, #053124) !important;
            }

            .danger {
                border-color: var(--danger-color, #FF7588) !important;
                background-color: var(--danger-color-background, #FFBCC6) !important;
                color: var(--danger-color-text, #ff1744) !important;
            }

            .error {
                border-color: var(--danger-color, #FF7588) !important;
                background-color: var(--danger-color-background, #FFBCC6) !important;
                color: var(--danger-color-text, #ff1744) !important;
            }

            .info {
                border-color: var(--info-color, #2DCEE3) !important;
                background-color: var(--info-color-background, #6CDDEB) !important;
                color: var(--info-color-text, #0B4A53) !important;
            }

            .warning {
                border-color: var(--warning-color, #FFA87D) !important;
                background-color: var(--warning-color-background, #FFD8C4) !important;
                color: var(--warning-color-text, #CA4300) !important;
            }

            #toastContainer {
                position: fixed;
                z-index: 1;
                bottom: 30px;
                left: 0;
                right: 0;
                margin: auto;
            }

            .toast {
                visibility: hidden;
                min-width: 250px;
                background-color: #333;
                color: #fff;
                text-align: center;
                border-radius: 2px;
                padding: 16px;
                font-size: 17px;
                border-left-width: 4rem;
            }

            @media (min-width: 768px) {

                #toastContainer {
                    width: 50%;
                }

                .toast {
                    margin-left: -125px;
                }

            }

            .toast.show:not(.sticky) {
                visibility: visible;
                -webkit-animation: fadeIn 0.5s, fadeOut 0.5s 4.5s forwards;
                animation: fadeIn 0.5s, fadeOut 0.5s 4.5s forwards;
            }

            .toast.show.sticky {
                visibility: visible;
                -webkit-animation: fadeIn 0.5s;
                animation: fadeIn 0.5s;
            }

            iron-icon {
                color: #FFF;
                width: 4rem;
                left: -4rem;
                text-align: center;
                position: absolute;
                top: 50%;
                margin-top: -12px;
                font-size: 1.25rem;
                font-weight: 400;
                line-height: 1;
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }

            @-webkit-keyframes fadeIn {
                from {
                    opacity: 0;
                }

                to {
                    opacity: 1;
                }
            }

            @keyframes fadeIn {
                from {
                    opacity: 0;
                }

                to {
                    opacity: 1;
                }
            }

            @-webkit-keyframes fadeOut {
                from {
                    opacity: 1;
                }

                to {
                    opacity: 0;
                }
            }

            @keyframes fadeOut {
                from {
                    opacity: 1;
                }

                to {
                    opacity: 0;
                }
            }
        </style>

        <div id="toastContainer">
            <template is="dom-repeat" items="[[toasts]]">
                <div class$="toast d-flex justify-content-around alert [[item.type]] show [[item.sticky]]"
                    on-tap="toastClicked">
                    <iron-icon icon="toast-icon:[[item.type]]"></iron-icon>
                    <div>
                        <strong>
                            <mil-formatted-html text="[[item.text]]"></mil-formatted-html>
                        </strong>
                    </div>
                </div>
            </template>
        </div>

    </template>

    <script>
        /**
         * `mil-toast` Description
         *
         * @summary ShortDescription.
         * @customElement
         * @polymer
         * @extends {Polymer.Element}
         */
        class milToast extends Polymer.GestureEventListeners(Polymer.Element) {

            static get is() {
                return 'mil-toast';
            }

            static get properties() {
                return {
                    type: {
                        type: String
                    },
                    text: {
                        type: String
                    },
                    sticky: {
                        type: Boolean
                    },
                    toasts: {
                        type: Array,
                        value: []
                    }
                };
            }

            /**
             * Use for one-time configuration of your component after local DOM is
             * initialized.
             */
            ready() {
                super.ready();
            }

            launch_toast(text, type, sticky, reload) {

                /* console.log("in launch_toast:");
                 console.log("text :", text);
                 console.log("type :", type);
                 console.log("sticky :", sticky);
                 console.log("reload :", reload);
   */
                if (!text) {
                    console.warn("Un toast sans texte a été reçu.")
                    return false};

                var timestamp = Date.now();

                var toast = {
                    "type": type,
                    "text": text,
                    "sticky": sticky,
                    "timestamp": timestamp,
                    "reload": reload
                }

                //Add toast to toasts array
                this.push('toasts', toast);

                var self = this;

                //Remove toast from object
                if (!sticky) {
                    setTimeout(
                        function () {
                            var index = self.toasts.map(function (toast) { return toast.timestamp; }).indexOf(timestamp);
                            self.splice('toasts', index, 1);
                        },
                        5000);
                }
            }

            close_toast(text, type, sticky) {
                if (!text) return false;

                var index = this.toasts.map(function (toast) { return toast.text; }).indexOf(text);
                this.splice('toasts', index, 1);
            }

            toastClicked(e) {
                var reload = e.model.item.reload;
                if (reload) {
                    window.location.reload();
                }
            }
        }

        window.customElements.define(milToast.is, milToast);
    </script>
</dom-module>